# 背景配置指南

## 1. 放置背景文件

将你的图片或视频素材放到 `backend/static/images/` 目录下，**按场景ID → 天气ID组织**：

```
backend/static/images/
├── livingroom/          # 场景 ID
│   ├── sunny/          # 天气 ID（晴天）
│   │   ├── day.png    # 白天（图片）
│   │   ├── dusk.mp4   # 傍晚（视频）
│   │   └── night.png  # 夜晚（图片）
│   ├── rainy/         # 天气 ID（雨天）
│   │   ├── day.mp4    # 支持视频
│   │   ├── dusk.png
│   │   └── night.png
│   └── storm/         # 天气 ID（雷雨）
│       ├── day.png
│       ├── dusk.png
│       └── night.png
├── bedroom/            # 另一个场景
│   └── sunny/
│       ├── day.png
│       ├── dusk.png
│       └── night.png
```

## 2. 配置场景

编辑 `backend/config/scenes.json`，**只需要写文件名**：

```json
{
  "scenes": [
    {
      "id": "livingroom",
      "name": "客厅",
      "weathers": [
        {
          "id": "sunny",
          "name": "晴天",
          "times": [
            {
              "id": "day",
              "name": "白天",
              "image": "day.png",
              "audio": "day.mp3",
              "atmosphere": {
                "brightness": 1.0,
                "contrast": 1.0,
                "saturation": 1.0
              }
            },
            {
              "id": "dusk",
              "name": "傍晚",
              "image": "dusk.png",
              "audio": "dusk.mp3",
              "atmosphere": {
                "brightness": 0.85,
                "contrast": 1.05,
                "saturation": 1.1
              }
            },
            {
              "id": "night",
              "name": "夜晚",
              "image": "night.png",
              "audio": "night.mp3",
              "atmosphere": {
                "brightness": 0.6,
                "contrast": 0.9,
                "saturation": 0.85
              }
            }
          ]
        }
      ]
    }
  ]
}
```

**注意：**
- `image` 字段只需要写文件名（如 `day.png` 或 `day.mp4`）
- 后端会自动根据场景ID和天气ID构建完整路径：`/images/{场景ID}/{天气ID}/{文件名}`
- 例如：`day.png` → `/images/livingroom/sunny/day.png`
- 例如：`dusk.mp4` → `/images/livingroom/sunny/dusk.mp4`
- 时间段固定为：`day`（白天）、`dusk`（傍晚/凌晨）、`night`（夜晚）
- **支持图片和视频混用**：可以某些时段用图片，某些时段用视频

## 3. 氛围参数说明

- `brightness`: 亮度 (0.0 - 2.0)
  - 0.5 = 很暗
  - 1.0 = 正常（默认）
  - 1.5 = 很亮

- `contrast`: 对比度 (0.0 - 2.0)
  - 0.5 = 低对比
  - 1.0 = 正常（默认）
  - 1.5 = 高对比

- `saturation`: 饱和度 (0.0 - 2.0)
  - 0.0 = 黑白
  - 1.0 = 正常（默认）
  - 1.5 = 鲜艳

## 4. 添加新天气步骤

1. 在对应场景文件夹下创建天气文件夹（如 `backend/static/images/livingroom/cloudy/`）
2. 将三个时间段的图片放入该文件夹（`day.png`、`dusk.png`、`night.png`）
3. 在 `scenes.json` 中添加配置：

```json
{
  "id": "cloudy",
  "name": "多云",
  "times": [
    {
      "id": "day",
      "name": "白天",
      "image": "day.png",
      "audio": "day.mp3",
      "atmosphere": {
        "brightness": 0.9,
        "contrast": 0.95,
        "saturation": 0.9
      }
    },
    {
      "id": "dusk",
      "name": "傍晚",
      "image": "dusk.png",
      "audio": "dusk.mp3",
      "atmosphere": {
        "brightness": 0.75,
        "contrast": 0.9,
        "saturation": 0.85
      }
    },
    {
      "id": "night",
      "name": "夜晚",
      "image": "night.png",
      "audio": "night.mp3",
      "atmosphere": {
        "brightness": 0.55,
        "contrast": 0.85,
        "saturation": 0.8
      }
    }
  ]
}
```

## 5. 支持的背景格式

### 图片格式
- GIF（动图）
- PNG / APNG
- JPG / JPEG
- WebP（包括动态 WebP）

### 视频格式
- MP4（推荐，兼容性最好）
- WebM
- OGG

**视频特性：**
- 自动循环播放
- 静音播放（不影响音频播放器）
- 自动适配屏幕尺寸
- 支持氛围滤镜效果

## 6. 使用视频背景示例

在 `scenes.json` 中配置视频背景：

```json
{
  "id": "dusk",
  "name": "傍晚",
  "image": "dusk.mp4",
  "audio": "dusk.mp3",
  "atmosphere": {
    "brightness": 0.85,
    "contrast": 1.05,
    "saturation": 1.1
  }
}
```

## 7. 故障排查

如果背景不显示：

1. **检查文件路径**
   - 确保文件在 `backend/static/images/{场景ID}/{天气ID}/` 目录下
   - 确保文件名与配置中的 `image` 字段一致

2. **检查文件名大小写**
   - Windows 不区分大小写，但 Linux 区分
   - 建议统一使用小写文件名

3. **测试文件访问**
   - 图片：`http://localhost:8000/images/livingroom/sunny/day.png`
   - 视频：`http://localhost:8000/images/livingroom/sunny/dusk.mp4`
   - 如果能访问，说明后端配置正确

4. **视频格式问题**
   - 如果视频不播放，尝试转换为 MP4 格式
   - 推荐使用 H.264 编码的 MP4 文件

5. **查看浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 和 Network 标签页的错误信息

6. **重启服务**
   - 修改配置后需要重启后端服务
   - 关闭窗口后重新运行 `start.bat`
