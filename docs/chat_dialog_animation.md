# 聊天对话框动画优化

## 动画流程

### 输入 → 回复模式

1. **输入框淡出** (0.15秒)
   - 输入框透明度从 1.0 → 0.0

2. **隐藏输入框**
   - 输入框设置为不可见

3. **高度变化 + 内容淡入（同时进行）** (0.3秒)
   - 对话框高度从 80px → 200px
   - 角色名称和消息标签同时从透明淡入
   - 使用 CUBIC 缓动，EASE_OUT

4. **打字机效果**
   - 逐字显示角色回复
   - 每个字符间隔 0.05秒

5. **继续提示**
   - 打字完成后显示倒三角提示
   - 循环闪烁动画（0.3 ↔ 1.0 透明度）

### 回复 → 输入模式

1. **回复内容淡出** (0.15秒)
   - 角色名称和消息标签透明度从 1.0 → 0.0
   - 同时淡出

2. **隐藏回复内容**
   - 回复UI元素设置为不可见

3. **高度变化 + 输入框淡入（同时进行）** (0.3秒)
   - 对话框高度从 200px → 80px
   - 输入框同时从透明淡入
   - 使用 CUBIC 缓动，EASE_OUT
   - 自动聚焦输入框

**注意**：点击"继续"提示后会触发此动画序列

## 继续提示位置

- 位置：对话框右下角内部
- 偏移：距离右边 20px，距离底部 5px
- 字体大小：20px
- 颜色：金黄色 (1.0, 0.9, 0.3)

## 技术细节

### 动画时长常量

```gdscript
const INPUT_HEIGHT = 80.0
const REPLY_HEIGHT = 200.0
const ANIMATION_DURATION = 0.3
const TYPING_SPEED = 0.05
```

### 关键函数

- `_transition_to_reply_mode()` - 输入到回复的完整动画序列
- `_transition_to_input_mode()` - 回复到输入的完整动画序列
- `_start_typing_effect()` - 打字机效果
- `_show_continue_indicator()` - 显示继续提示

## 用户体验

- 流畅的视觉过渡，避免突兀的UI切换
- 清晰的状态反馈（淡入淡出）
- 打字机效果增加真实感
- 继续提示明确告知用户可以继续
