# 背景音配置指南

## 功能说明

每个场景的不同天气都可以配置独特的背景音效，营造沉浸式氛围体验。

## 快速开始

### 1. 准备音频文件

将音频文件放入对应的场景和天气文件夹，按时间段组织：

```
backend/static/audio/
├── livingroom/         # 场景ID
│   ├── sunny/         # 天气ID（晴天）
│   │   ├── day.mp3   # 白天音效
│   │   ├── dusk.mp3  # 傍晚音效
│   │   └── night.mp3 # 夜晚音效
│   ├── rainy/        # 雨天
│   │   ├── day.mp3
│   │   ├── dusk.mp3
│   │   └── night.mp3
│   └── storm/        # 雷雨
│       ├── day.mp3
│       ├── dusk.mp3
│       └── night.mp3
├── bedroom/           # 另一个场景
│   └── sunny/
│       ├── day.mp3
│       ├── dusk.mp3
│       └── night.mp3
```

### 2. 配置音频路径

编辑 `backend/config/scenes.json`：

```json
{
  "scenes": [
    {
      "id": "livingroom",
      "name": "客厅",
      "weathers": [
        {
          "id": "sunny",
          "name": "晴天",
          "times": [
            {
              "id": "day",
              "name": "白天",
              "image": "day.png",
              "audio": "day.mp3",    // 添加音频配置
              "atmosphere": {
                "brightness": 1.0,
                "contrast": 1.0,
                "saturation": 1.0
              }
            }
          ]
        }
      ]
    }
  ]
}
```

### 3. 重启服务

运行 `start.bat` 重启服务，音频配置即可生效。

## 音频文件要求

### 推荐格式
- **MP3**：兼容性最好，推荐使用
- **OGG**：开源格式，文件较小
- **WAV**：无损音质，但文件较大

### 推荐参数
- 比特率：128-192 kbps
- 采样率：44.1 kHz
- 声道：立体声或单声道
- 时长：30秒-2分钟（会循环播放）

### 文件大小
- 建议单个文件 < 5MB
- 过大的文件会影响加载速度

## 获取音频资源

### 免费音效网站

1. **Freesound** (https://freesound.org/)
   - 海量免费音效
   - 需要注册账号
   - 支持按授权筛选

2. **Zapsplat** (https://www.zapsplat.com/)
   - 免费音效库
   - 包含大量环境音
   - 每日下载有限制

3. **Pixabay** (https://pixabay.com/sound-effects/)
   - 完全免费可商用
   - 无需注册
   - 音效质量高

### 搜索关键词推荐

| 天气类型 | 英文关键词 | 中文说明 |
|---------|-----------|---------|
| 晴天 | `birds chirping`, `gentle breeze`, `nature ambience` | 鸟鸣、微风、自然环境音 |
| 雨天 | `rain`, `light rain`, `rain on window` | 雨声、小雨、窗外雨声 |
| 雷雨 | `thunderstorm`, `heavy rain`, `thunder` | 雷暴、大雨、雷声 |
| 多云 | `wind`, `soft wind`, `cloudy ambience` | 风声、柔和风声 |
| 雪天 | `snow`, `winter ambience`, `blizzard` | 雪声、冬季环境音 |

## 使用说明

### 播放控制
- 右下角有一个圆形音频按钮
- 点击按钮可以播放/暂停背景音
- 音频会自动循环播放

### 自动切换
- 切换天气时，背景音会自动切换
- 如果正在播放，新音频会自动开始播放
- 如果已暂停，新音频不会自动播放

## 添加新场景音频

### 步骤

1. **创建场景和天气音频文件夹**
   ```
   backend/static/audio/livingroom/cloudy/
   ```

2. **添加音频文件（三个时间段）**
   ```
   backend/static/audio/livingroom/cloudy/
   ├── day.mp3
   ├── dusk.mp3
   └── night.mp3
   ```

3. **更新配置文件**
   ```json
   {
     "id": "cloudy",
     "name": "多云",
     "times": [
       {
         "id": "day",
         "name": "白天",
         "image": "day.png",
         "audio": "day.mp3"
       },
       {
         "id": "dusk",
         "name": "傍晚",
         "image": "dusk.png",
         "audio": "dusk.mp3"
       },
       {
         "id": "night",
         "name": "夜晚",
         "image": "night.png",
         "audio": "night.mp3"
       }
     ]
   }
   ```

## 音频处理技巧

### 使用 Audacity（免费音频编辑软件）

1. **裁剪音频**
   - 选择需要的片段
   - 删除多余部分

2. **淡入淡出**
   - 效果 → 淡入/淡出
   - 让循环更自然

3. **调整音量**
   - 效果 → 放大
   - 建议音量不要太大

4. **导出为 MP3**
   - 文件 → 导出 → 导出为 MP3
   - 比特率选择 128-192 kbps

### 创建无缝循环

1. 选择音频末尾 1-2 秒
2. 应用淡出效果
3. 选择音频开头 1-2 秒
4. 应用淡入效果
5. 这样循环播放时更自然

## 故障排除

### 音频无法播放
1. 检查文件路径是否正确
2. 确认文件格式是否支持
3. 查看浏览器控制台错误信息
4. 确认后端服务已重启

### 音频加载缓慢
1. 压缩音频文件大小
2. 降低比特率（如 128 kbps）
3. 使用 MP3 格式

### 音频循环不自然
1. 使用音频编辑软件添加淡入淡出
2. 选择本身就适合循环的音效
3. 调整音频长度

## 示例配置

完整的场景配置示例：

```json
{
  "scenes": [
    {
      "id": "livingroom",
      "name": "客厅",
      "weathers": [
        {
          "id": "sunny",
          "name": "晴天",
          "times": [
            {
              "id": "day",
              "name": "白天",
              "image": "day.png",
              "audio": "day.mp3",
              "atmosphere": {
                "brightness": 1.0,
                "contrast": 1.0,
                "saturation": 1.0
              }
            },
            {
              "id": "dusk",
              "name": "傍晚",
              "image": "dusk.png",
              "audio": "dusk.mp3",
              "atmosphere": {
                "brightness": 0.85,
                "contrast": 1.05,
                "saturation": 1.1
              }
            },
            {
              "id": "night",
              "name": "夜晚",
              "image": "night.png",
              "audio": "night.mp3",
              "atmosphere": {
                "brightness": 0.6,
                "contrast": 0.9,
                "saturation": 0.85
              }
            }
          ]
        },
        {
          "id": "rainy",
          "name": "雨天",
          "times": [
            {
              "id": "day",
              "name": "白天",
              "image": "day.png",
              "audio": "day.mp3",
              "atmosphere": {
                "brightness": 0.7,
                "contrast": 0.8,
                "saturation": 0.8
              }
            }
          ]
        }
      ]
    }
  ]
}
```

## 技术细节

### 音频格式支持
- 浏览器原生支持 MP3、OGG、WAV
- 使用 HTML5 Audio API
- 自动循环播放（loop 属性）

### 性能优化
- 音频文件按需加载
- 切换天气时预加载新音频
- 使用浏览器缓存

### 兼容性
- 支持所有现代浏览器
- Chrome、Firefox、Safari、Edge
- 移动端浏览器也支持
